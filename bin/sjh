#!/usr/bin/env node

//æ ¸å¿ƒå¤„ç†å‘½ä»¤è¡Œ
const program = require('commander');
const figlet = require('figlet');
const versionStr = figlet.textSync('sjh0.0.1', {
  font: 'Ghost',
  horizontalLayout: 'default',
  verticalLayout: 'default'
});
const _version = require('../package.json').version;
const Printer = require('@darkobits/lolcatjs')
const chalk = require('chalk');
const ora = require('ora');
const shell = require('shelljs')
const inquirer = require('inquirer');
const json2ts = require('json2ts');
const download = require('download-git-repo');
const template = 'direct:https://github.com/lgwebdream/gulp-website.git';
program.version(Printer.default.fromString(versionStr+"\n 1039460820@qq.com"), '-v --version');
program.option("-i, --init", "åˆå§‹åŒ–é¡¹ç›®ğŸ¶");
if(program.init){
  console.log('åˆå§‹åŒ–é¡¹ç›®ğŸ¶')
}
program.option('-T, --no-tests', 'ignore test hook')
const bindHandle = {
  init(otherParams) {
    console.log('è¿›å…¥æˆ‘çš„æ‰§è¡Œç¨‹åº....')
    inquirer
      .prompt([
        {
          type: "text",
          name: "dirname",
          meassage: "è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°"
        }, {
          type: "list",
          name: "jstype",
          meassage: "è¯·é€‰æ‹©è¯­è¨€",
          choices: ["typescript", "ecmaScript"]
        }
      ]).then(ansers => {
        console.log('è·å–åˆ°ç”¨æˆ·è¾“å…¥', ansers);
        const _pwddir = shell.pwd().stdout;
        const projectPath = `${_pwddir}/${ansers.dirname}`;
        console.log('ç”¨æˆ·çš„å…¨è·¯å¾„', projectPath);
        console.log('ç”¨æˆ·çš„å…¨è·¯å¾„', ansers);
        shell.rm('-rf', projectPath);
        shell.mkdir(projectPath);
        const spinner = ora('downloadingã€‚ã€‚ã€‚ã€‚ ');
        spinner.start();
        download(template, projectPath, {
          clone: true
        }, err => {
          console.log('err: ', err);
          spinner.stop();
          if (err) {
            console.log('ä¸‹è½½å¤±è´¥')
          } else {
            shell.sed('-i', 'yd', ansers.dirname,projectPath+'/package.json')
            console.log(chalk.green('ğŸš€ğŸ›«ï¸é¡¹ç›®â€˜ä¸‹è½½æˆåŠŸâ€™'))
          }
        })
      }).catch(err => {
        console.log('å¯åŠ¨å¼‚å¸¸')
      })
  },
  js2ts(otherParams){
    const yiData = {
      yideng: "sjh",
      data:{
        age: 23
      }
    }
    const jsonContent = JSON.stringify(yiData);
    console.log('json2ts: ', json2ts);
    let result = json2ts.convert(jsonContent);
    console.log('result', result);
  }
}
program.usage("[cmd] <options>")
  //init å’Œinitä¸ä¸€æ ·

  .arguments("<cmd> [env]")
  .action(function (cmd, otherParams) {
    console.log('ğŸ', cmd)
    console.log('ğŸŠ', otherParams)
    const handler = bindHandle[cmd];
    if (typeof handler === 'undefined') {
      console.log('æš‚æœªæä¾›')
      console.error(chalk.yellow('â€˜éå¸¸é—æ†¾â€™') + chalk.red(cmd) + chalk.blue())
    } else {
      handler();
    }
  })
program.parse(process.argv);
